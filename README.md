# .NET SDK for OpenFGA

[![Nuget](https://img.shields.io/nuget/v/OpenFga.Sdk?label=OpenFga.Sdk&style=flat-square)](https://www.nuget.org/packages/OpenFga.Sdk)
[![Release](https://img.shields.io/github/v/release/openfga/dotnet-sdk?sort=semver&color=green)](https://github.com/openfga/dotnet-sdk/releases)
[![License](https://img.shields.io/badge/License-Apache_2.0-blue.svg)](./LICENSE)
[![FOSSA Status](https://app.fossa.com/api/projects/git%2Bgithub.com%2Fopenfga%2Fdotnet-sdk.svg?type=shield)](https://app.fossa.com/projects/git%2Bgithub.com%2Fopenfga%2Fdotnet-sdk?ref=badge_shield)
[![Discord Server](https://img.shields.io/discord/759188666072825867?color=7289da&logo=discord "Discord Server")](https://discord.com/channels/759188666072825867/930524706854031421)
[![Twitter](https://img.shields.io/twitter/follow/openfga?color=%23179CF0&logo=twitter&style=flat-square "@openfga on Twitter")](https://twitter.com/openfga)

This is an autogenerated SDK for OpenFGA. It provides a wrapper around the [OpenFGA API definition](https://openfga.dev/api).

## Table of Contents

- [About OpenFGA](#about)
- [Resources](#resources)
- [Installation](#installation)
- [Getting Started](#getting-started)
  - [Initializing the API Client](#initializing-the-api-client)
  - [Get your Store ID](#get-your-store-id)
  - [Calling the API](#calling-the-api)
    - [List All Stores](#list-stores)
    - [Create a Store](#create-store)
    - [Get a Store](#get-store)
    - [Delete a Store](#delete-store)
    - [Write Authorization Model](#write-authorization-model)
    - [Read a Single Authorization Model](#read-a-single-authorization-model)
    - [Read Authorization Model IDs](#read-authorization-model-ids)
    - [Check](#check)
    - [Write Tuples](#write-tuples)
    - [Delete Tuples](#delete-tuples)
    - [Expand](#expand)
    - [Read Tuples](#read-tuples)
    - [Read Changes (Watch)](#read-changes-watch)
    - [List Objects](#list-objects)
  - [API Endpoints](#api-endpoints)
  - [Models](#models)
- [Contributing](#contributing)
  - [Issues](#issues)
  - [Pull Requests](#pull-requests)
- [License](#license)

## About

[OpenFGA](https://openfga.dev) is an open source Fine-Grained Authorization solution inspired by [Google's Zanzibar paper](https://research.google/pubs/pub48190/). It was created by the FGA team at [Auth0](https://auth0.com) based on [Auth0 Fine-Grained Authorization (FGA)](https://fga.dev), available under [a permissive license (Apache-2)](https://github.com/openfga/rfcs/blob/main/LICENSE) and welcomes community contributions.

OpenFGA is designed to make it easy for application builders to model their permission layer, and to add and integrate fine-grained authorization into their applications. OpenFGAâ€™s design is optimized for reliability and low latency at a high scale.


## Resources

- [OpenFGA Documentation](https://openfga.dev/docs)
- [OpenFGA API Documentation](https://openfga.dev/api/service)
- [Twitter](https://twitter.com/openfga)
- [OpenFGA Discord Community](https://discord.gg/8naAwJfWN6)
- [Zanzibar Academy](https://zanzibar.academy)
- [Google's Zanzibar Paper (2019)](https://research.google/pubs/pub48190/)

## Installation

The OpenFGA .NET SDK is available on [NuGet](https://www.nuget.org/).

You can install it using:

* The [dotnet CLI](https://docs.microsoft.com/en-us/nuget/consume-packages/install-use-packages-dotnet-cli)
```powershell
dotnet add package OpenFga.Sdk
```

* The [Package Manager Console](https://docs.microsoft.com/en-us/nuget/consume-packages/install-use-packages-powershell) inside Visual Studio:

```powershell
Install-Package OpenFga.Sdk
```

* [Visual Studio](https://docs.microsoft.com/en-us/nuget/consume-packages/install-use-packages-visual-studio), [Visual Studio for Mac](https://docs.microsoft.com/en-us/visualstudio/mac/nuget-walkthrough) and [IntelliJ Rider](https://www.jetbrains.com/help/rider/Using_NuGet.html)

Search for and install `OpenFga.Sdk` in each of their respective package manager UIs.


## Getting Started

### Initializing the API Client

[Learn how to initialize your SDK](https://openfga.dev/docs/getting-started/setup-sdk-client)

Without an API Token

```csharp
using OpenFga.Sdk.Api;
using OpenFga.Sdk.Client;
using OpenFga.Sdk.Configuration;
using OpenFga.Sdk.Model;

namespace Example {
    public class Example {
        public static void Main() {
            try {
                var configuration = new Configuration() {
                    ApiScheme = Environment.GetEnvironmentVariable("OPENFGA_API_SCHEME"), // optional, defaults to "https"
                    ApiHost = Environment.GetEnvironmentVariable("OPENFGA_API_HOST"), // required, define without the scheme (e.g. api.fga.example instead of https://api.fga.example)
                    StoreId = Environment.GetEnvironmentVariable("OPENFGA_STORE_ID"), // not needed when calling `CreateStore` or `ListStores`
                };
                var openFgaApi = new OpenFgaApi(configuration);
                var response = openFgaApi.ReadAuthorizationModels();
            } catch (ApiException e) {
                 Debug.Print("Status Code: "+ e.ErrorCode);
            }
        }
    }
}
```

With an API Token

```csharp
using OpenFga.Sdk.Api;
using OpenFga.Sdk.Client;
using OpenFga.Sdk.Configuration;
using OpenFga.Sdk.Model;

namespace Example {
    public class Example {
        public static async void Main() {
            try {
                var configuration = new Configuration() {
                    ApiScheme = Environment.GetEnvironmentVariable("OPENFGA_API_SCHEME"), // optional, defaults to "https"
                    ApiHost = Environment.GetEnvironmentVariable("OPENFGA_API_HOST"), // required, define without the scheme (e.g. api.fga.example instead of https://api.fga.example)
                    StoreId = Environment.GetEnvironmentVariable("OPENFGA_STORE_ID"), // not needed when calling `CreateStore` or `ListStores`
                    Credentials = new Credentials() {
                        Method = CredentialsMethod.ApiToken,
                        Config = new CredentialsConfig() {
                            ApiToken = Environment.GetEnvironmentVariable("OPENFGA_API_TOKEN"),  // will be passed as the "Authorization: Bearer ${ApiToken}" request header
                        }
                    }
                };
                var openFgaApi = new OpenFgaApi(configuration);
                var response = await openFgaApi.ReadAuthorizationModels();
            } catch (ApiException e) {
                 Debug.Print("Status Code: "+ e.ErrorCode);
            }
        }
    }
}
```


### Get your Store ID

You need your store id to call the OpenFGA API (unless it is to call the [CreateStore](#create-store) or [ListStores](#list-stores) methods).

If your server is configured with [authentication enabled](https://openfga.dev/docs/getting-started/setup-openfga#configuring-authentication), you also need to have your credentials ready.

### Calling the API

#### List Stores

[API Documentation](https://openfga.dev/api/service/docs/api#/Stores/ListStores)

```csharp
var configuration = new Configuration() {
    ApiScheme = Environment.GetEnvironmentVariable("OPENFGA_API_SCHEME"),
    ApiHost = Environment.GetEnvironmentVariable("OPENFGA_API_HOST"),
};
var openFgaApi = new OpenFgaApi(configuration);
var response = await openFgaApi.ListStores();

// stores = [{ "id": "01FQH7V8BEG3GPQW93KTRFR8JB", "name": "FGA Demo Store", "created_at": "2022-01-01T00:00:00.000Z", "updated_at": "2022-01-01T00:00:00.000Z" }]
```

#### Create Store

[API Documentation](https://openfga.dev/api/service/docs/api#/Stores/CreateStore)

```csharp
var configuration = new Configuration() {
    ApiScheme = Environment.GetEnvironmentVariable("OPENFGA_API_SCHEME"),
    ApiHost = Environment.GetEnvironmentVariable("OPENFGA_API_HOST"),
};
var openFgaApi = new OpenFgaApi(configuration);
var store = await openFgaApi.CreateStore(new CreateStoreRequest(){Name = "FGA Demo"})

// store.Id = "01FQH7V8BEG3GPQW93KTRFR8JB"

// store store.Id in database

// update the storeId of the current instance
openFgaApi.StoreId = storeId;

// continue calling the API normally
```

#### Get Store

[API Documentation](https://openfga.dev/api/service/docs/api#/Stores/GetStore)

> Requires a client initialized with a storeId

```csharp
var configuration = new Configuration() {
    ApiScheme = Environment.GetEnvironmentVariable("OPENFGA_API_SCHEME"),
    ApiHost = Environment.GetEnvironmentVariable("OPENFGA_API_HOST"),
    StoreId = Environment.GetEnvironmentVariable("OPENFGA_STORE_ID"),
};
var openFgaApi = new OpenFgaApi(configuration);
var store = await openFgaApi.GetStore();

// store = { "id": "01FQH7V8BEG3GPQW93KTRFR8JB", "name": "FGA Demo Store", "created_at": "2022-01-01T00:00:00.000Z", "updated_at": "2022-01-01T00:00:00.000Z" }
```

#### Delete Store

[API Documentation](https://openfga.dev/api/service/docs/api#/Stores/DeleteStore)

> Requires a client initialized with a storeId

```csharp
var store = await openFgaApi.DeleteStore();
```

#### Write Authorization Model

[API Documentation](https://openfga.dev/api/service#/Authorization%20Models/WriteAuthorizationModel)

> Note: To learn how to build your authorization model, check the Docs at https://openfga.dev/docs.

> Learn more about [the OpenFGA configuration language](https://openfga.dev/docs/configuration-language).

```csharp
var documentRelations = new Dictionary<string, Userset>()
{
    {"writer", new Userset(_this: new object())},
    {
        "viewer",
        new Userset(union: new Usersets(new List<Userset>()
            {new(new object(), new ObjectRelation("", "writer"))}))
    }
};
var userRelations = new Dictionary<string, Userset>()
{
};

var body = new WriteAuthorizationModelRequest(new List<TypeDefinition>() {new("document", documentRelations), new("user", userRelations)});
var response = await openFgaApi.WriteAuthorizationModel(body);

// response.AuthorizationModelId = 1uHxCSuTP0VKPYSnkq1pbb1jeZw
```

#### Read a Single Authorization Model

[API Documentation](https://openfga.dev/api/service#/Authorization%20Models/ReadAuthorizationModel)

```csharp
string authorizationModelId = "1uHxCSuTP0VKPYSnkq1pbb1jeZw"; // Assuming `1uHxCSuTP0VKPYSnkq1pbb1jeZw` is an id of an existing model
var response = await openFgaApi.ReadAuthorizationModel(authorizationModelId);

// response.AuthorizationModel.Id = "1uHxCSuTP0VKPYSnkq1pbb1jeZw"
// response.AuthorizationModel.TypeDefinitions = [{ "type": "document", "relations": { ... } }, { "type": "user", "relations": { ... }}]
```

#### Read Authorization Model IDs

[API Documentation](https://openfga.dev/api/service#/Authorization%20Models/ReadAuthorizationModels)

```csharp
var response = await openFgaApi.ReadAuthorizationModels();

// response.AuthorizationModelIds = ["1uHxCSuTP0VKPYSnkq1pbb1jeZw", "GtQpMohWezFmIbyXxVEocOCxxgq"];
```

#### Check

[API Documentation](https://openfga.dev/api/service#/Relationship%20Queries/Check)

```csharp
var body =
    new CheckRequest{tupleKey: new TupleKey("document:roadmap", "viewer", "user:81684243-9356-4421-8fbf-a4f8d36aa31b"), AuthorizationModelId = "1uHxCSuTP0VKPYSnkq1pbb1jeZw"};
var response = await openFgaApi.Check(body);
// response.Allowed = true
```

#### Write Tuples

[API Documentation](https://openfga.dev/api/service#/Relationship%20Tuples/Write)

```csharp
var body = new WriteRequest{Writes = new TupleKeys(new List<TupleKey>
    {new("document:roadmap", "viewer", "user:81684243-9356-4421-8fbf-a4f8d36aa31b")}), AuthorizationModelId = "1uHxCSuTP0VKPYSnkq1pbb1jeZw"};
var response = await openFgaApi.Write(body);
```

#### Delete Tuples

[API Documentation](https://openfga.dev/api/service#/Relationship%20Tuples/Write)

```csharp
var body = new WriteRequest{Deletes = new TupleKeys(new List<TupleKey>
    {new("document:roadmap", "viewer", "user:81684243-9356-4421-8fbf-a4f8d36aa31b")}), AuthorizationModelId = "1uHxCSuTP0VKPYSnkq1pbb1jeZw"};
var response = await openFgaApi.Write(body);
```

#### Expand

[API Documentation](https://openfga.dev/api/service#/Relationship%20Queries/Expand)

```csharp
var body = new ExpandRequest{TupleKey = new TupleKey("document:roadmap", "viewer"), AuthorizationModelId = "1uHxCSuTP0VKPYSnkq1pbb1jeZw"};
var response = await openFgaApi.Expand(body);

// response.Tree.Root = {"name":"document:roadmap#viewer","leaf":{"users":{"users":["user:81684243-9356-4421-8fbf-a4f8d36aa31b","user:f52a4f7a-054d-47ff-bb6e-3ac81269988f"]}}}
```

#### Read Changes

[API Documentation](https://openfga.dev/api/service#/Relationship%20Tuples/Read)

```csharp
// Find if a relationship tuple stating that a certain user is a viewer of a certain document
var body = new ReadRequest(new TupleKey(
    _object: "document:roadmap",
    relation: "viewer",
    user: "user:81684243-9356-4421-8fbf-a4f8d36aa31b");

// Find all relationship tuples where a certain user has a relationship as any relation to a certain document
var body = new ReadRequest(new TupleKey(
    _object: "document:roadmap",
    user: "user:81684243-9356-4421-8fbf-a4f8d36aa31b"));

// Find all relationship tuples where a certain user is a viewer of any document
var body = new ReadRequest(new TupleKey(
    _object: "document:",
    relation: "viewer",
    user: "user:81684243-9356-4421-8fbf-a4f8d36aa31b"));

// Find all relationship tuples where any user has a relationship as any relation with a particular document
var body = new ReadRequest(new TupleKey(
    _object: "document:roadmap"));

// Read all stored relationship tuples
body := ReadRequest()

var response = await openFgaApi.Read(body);

// In all the above situations, the response will be of the form:
// response = {"tuples":[{"key":{"user":"...","relation":"...","object":"..."},"timestamp":"..."}]}
```

#### Read Changes (Watch)

[API Documentation](https://openfga.dev/api/service#/Relationship%20Tuples/ReadChanges)

```csharp
var type = 'document';
var pageSize = 25;
var continuationToken = 'eyJwayI6IkxBVEVTVF9OU0NPTkZJR19hdXRoMHN0b3JlIiwic2siOiIxem1qbXF3MWZLZExTcUoyN01MdTdqTjh0cWgifQ==';

var response = await openFgaApi.ReadChanges(type, pageSize, continuationToken);

// response.continuation_token = ...
// response.changes = [
//   { tuple_key: { user, relation, object }, operation: "writer", timestamp: ... },
//   { tuple_key: { user, relation, object }, operation: "viewer", timestamp: ... }
// ]
```

#### List Objects

[API Documentation](https://openfga.dev/api/service#/Relationship%20Queries/ListObjects)

```csharp
var body = new ListObjectsRequest{
    AuthorizationModelId = "1uHxCSuTP0VKPYSnkq1pbb1jeZw",
    User = "user:81684243-9356-4421-8fbf-a4f8d36aa31b",
    Relation = "viewer",
    Type = "document",
    ContextualTuples = new ContextualTupleKeys() {
        TupleKeys = new List<TupleKey> {
            new("document:budget", "writer", "user:81684243-9356-4421-8fbf-a4f8d36aa31b")
        }
    }
};
var response = await openFgaApi.ListObjects(body);

// response.Objects = ["document:roadmap"]
```


### API Endpoints

| Method | HTTP request | Description |
| ------------- | ------------- | ------------- |
| [**Check**](docs/OpenFgaApi.md#check) | **POST** /stores/{store_id}/check | Check whether a user is authorized to access an object |
| [**CreateStore**](docs/OpenFgaApi.md#createstore) | **POST** /stores | Create a store |
| [**DeleteStore**](docs/OpenFgaApi.md#deletestore) | **DELETE** /stores/{store_id} | Delete a store |
| [**Expand**](docs/OpenFgaApi.md#expand) | **POST** /stores/{store_id}/expand | Expand all relationships in userset tree format, and following userset rewrite rules.  Useful to reason about and debug a certain relationship |
| [**GetStore**](docs/OpenFgaApi.md#getstore) | **GET** /stores/{store_id} | Get a store |
| [**ListObjects**](docs/OpenFgaApi.md#listobjects) | **POST** /stores/{store_id}/list-objects | [EXPERIMENTAL] Get all objects of the given type that the user has a relation with |
| [**ListStores**](docs/OpenFgaApi.md#liststores) | **GET** /stores | List all stores |
| [**Read**](docs/OpenFgaApi.md#read) | **POST** /stores/{store_id}/read | Get tuples from the store that matches a query, without following userset rewrite rules |
| [**ReadAssertions**](docs/OpenFgaApi.md#readassertions) | **GET** /stores/{store_id}/assertions/{authorization_model_id} | Read assertions for an authorization model ID |
| [**ReadAuthorizationModel**](docs/OpenFgaApi.md#readauthorizationmodel) | **GET** /stores/{store_id}/authorization-models/{id} | Return a particular version of an authorization model |
| [**ReadAuthorizationModels**](docs/OpenFgaApi.md#readauthorizationmodels) | **GET** /stores/{store_id}/authorization-models | Return all the authorization models for a particular store |
| [**ReadChanges**](docs/OpenFgaApi.md#readchanges) | **GET** /stores/{store_id}/changes | Return a list of all the tuple changes |
| [**Write**](docs/OpenFgaApi.md#write) | **POST** /stores/{store_id}/write | Add or delete tuples from the store |
| [**WriteAssertions**](docs/OpenFgaApi.md#writeassertions) | **PUT** /stores/{store_id}/assertions/{authorization_model_id} | Upsert assertions for an authorization model ID |
| [**WriteAuthorizationModel**](docs/OpenFgaApi.md#writeauthorizationmodel) | **POST** /stores/{store_id}/authorization-models | Create a new authorization model |



### Models

 - [Model.Any](docs/Any.md)
 - [Model.Assertion](docs/Assertion.md)
 - [Model.AuthorizationModel](docs/AuthorizationModel.md)
 - [Model.CheckRequest](docs/CheckRequest.md)
 - [Model.CheckResponse](docs/CheckResponse.md)
 - [Model.Computed](docs/Computed.md)
 - [Model.ContextualTupleKeys](docs/ContextualTupleKeys.md)
 - [Model.CreateStoreRequest](docs/CreateStoreRequest.md)
 - [Model.CreateStoreResponse](docs/CreateStoreResponse.md)
 - [Model.Difference](docs/Difference.md)
 - [Model.ErrorCode](docs/ErrorCode.md)
 - [Model.ExpandRequest](docs/ExpandRequest.md)
 - [Model.ExpandResponse](docs/ExpandResponse.md)
 - [Model.GetStoreResponse](docs/GetStoreResponse.md)
 - [Model.InternalErrorCode](docs/InternalErrorCode.md)
 - [Model.InternalErrorMessageResponse](docs/InternalErrorMessageResponse.md)
 - [Model.Leaf](docs/Leaf.md)
 - [Model.ListObjectsRequest](docs/ListObjectsRequest.md)
 - [Model.ListObjectsResponse](docs/ListObjectsResponse.md)
 - [Model.ListStoresResponse](docs/ListStoresResponse.md)
 - [Model.Metadata](docs/Metadata.md)
 - [Model.Node](docs/Node.md)
 - [Model.Nodes](docs/Nodes.md)
 - [Model.NotFoundErrorCode](docs/NotFoundErrorCode.md)
 - [Model.ObjectRelation](docs/ObjectRelation.md)
 - [Model.PathUnknownErrorMessageResponse](docs/PathUnknownErrorMessageResponse.md)
 - [Model.ReadAssertionsResponse](docs/ReadAssertionsResponse.md)
 - [Model.ReadAuthorizationModelResponse](docs/ReadAuthorizationModelResponse.md)
 - [Model.ReadAuthorizationModelsResponse](docs/ReadAuthorizationModelsResponse.md)
 - [Model.ReadChangesResponse](docs/ReadChangesResponse.md)
 - [Model.ReadRequest](docs/ReadRequest.md)
 - [Model.ReadResponse](docs/ReadResponse.md)
 - [Model.RelationMetadata](docs/RelationMetadata.md)
 - [Model.RelationReference](docs/RelationReference.md)
 - [Model.Status](docs/Status.md)
 - [Model.Store](docs/Store.md)
 - [Model.Tuple](docs/Tuple.md)
 - [Model.TupleChange](docs/TupleChange.md)
 - [Model.TupleKey](docs/TupleKey.md)
 - [Model.TupleKeys](docs/TupleKeys.md)
 - [Model.TupleOperation](docs/TupleOperation.md)
 - [Model.TupleToUserset](docs/TupleToUserset.md)
 - [Model.TypeDefinition](docs/TypeDefinition.md)
 - [Model.Users](docs/Users.md)
 - [Model.Userset](docs/Userset.md)
 - [Model.UsersetTree](docs/UsersetTree.md)
 - [Model.UsersetTreeDifference](docs/UsersetTreeDifference.md)
 - [Model.UsersetTreeTupleToUserset](docs/UsersetTreeTupleToUserset.md)
 - [Model.Usersets](docs/Usersets.md)
 - [Model.ValidationErrorMessageResponse](docs/ValidationErrorMessageResponse.md)
 - [Model.WriteAssertionsRequest](docs/WriteAssertionsRequest.md)
 - [Model.WriteAuthorizationModelRequest](docs/WriteAuthorizationModelRequest.md)
 - [Model.WriteAuthorizationModelResponse](docs/WriteAuthorizationModelResponse.md)
 - [Model.WriteRequest](docs/WriteRequest.md)



## Contributing

### Issues

If you have found a bug or if you have a feature request, please report them on the [sdk-generator repo](https://github.com/openfga/sdk-generator/issues) issues section. Please do not report security vulnerabilities on the public GitHub issue tracker.

### Pull Requests

All changes made to this repo will be overwritten on the next generation, so we kindly ask that you send all pull requests related to the SDKs to the [sdk-generator repo](https://github.com/openfga/sdk-generator) instead.

## Author

[OpenFGA](https://github.com/openfga)

## License

This project is licensed under the Apache-2.0 license. See the [LICENSE](https://github.com/openfga/dotnet-sdk/blob/main/LICENSE) file for more info.

The code in this repo was auto generated by [OpenAPI Generator](https://github.com/OpenAPITools/openapi-generator) from a template based on the [csharp-netcore template](https://github.com/OpenAPITools/openapi-generator/tree/master/modules/openapi-generator/src/main/resources/csharp-netcore), licensed under the [Apache License 2.0](https://github.com/OpenAPITools/openapi-generator/blob/master/LICENSE).

